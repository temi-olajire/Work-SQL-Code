SELECT a.patient_id AS 'PATIENT ID',  a.patient_identifier AS 'PATIENT IDENTIFIER', 
CASE WHEN a.gender = 'M' THEN 'MALE' WHEN  a.gender = 'F' THEN 'FEMALE' ELSE '' END AS 'GENDER',
a.phone_number AS 'PHONE NUMBER',
a.patient_name AS 'PATIENT NAME',
a.family_name AS 'FAMILY NAME',
a.age AS 'AGE',
(SELECT NAME FROM address_hierarchy_entry WHERE level_id=2 AND user_generated_id=(SELECT property_value FROM global_property WHERE property='partner_reporting_state')) AS 'STATE',
(SELECT NAME FROM address_hierarchy_entry WHERE level_id=3 AND user_generated_id=(SELECT property_value FROM global_property WHERE property='partner_reporting_lga_code')) AS 'LGA',
(SELECT property_value FROM global_property WHERE property='facility_name') AS 'FACILITY NAME',
(SELECT property_value FROM global_property WHERE property='facility_datim_code') AS 'FACILITY DATIM CODE',
b.service_area_name AS 'SERVICE AREA NAME',
a.hiv_score AS 'RISK ASSESSMENT SCORE',
CASE WHEN a.ncd_hypertensive = 1 THEN 'YES' WHEN  a.ncd_hypertensive = 0 THEN 'NO' ELSE '' END AS 'HYPERTENSIVE',
CASE WHEN a.ncd_htn_medication = 1 THEN 'YES' WHEN  a.ncd_htn_medication = 0 THEN 'NO' ELSE '' END AS 'MEDICATION FOR HTN',
a.ncd_bp_upper AS 'LATEST BP UPPER',
a.ncd_bp_lower AS 'LATEST BP LOWER',
CASE WHEN a.ncd_diabetic = 1 THEN 'YES' WHEN  a.ncd_diabetic = 0 THEN 'NO' ELSE '' END AS 'DIABETIC',
CASE WHEN a.ncd_dm_medication = 1 THEN 'YES' WHEN  a.ncd_dm_medication = 0 THEN 'NO' ELSE '' END AS 'MEDICATION FOR DM',
a.ncd_rbs AS 'LATEST RBS',
a.bmi_weight AS 'BMI WEIGHT',
a.bmi_height AS 'BMI HEIGHT',
a.bmi_value AS 'BMI',
a.bmi_remark AS 'BMI RANGE',
a.ncd_score AS 'NCD SCREENING SCORE',
CASE WHEN (SELECT COUNT(patient_id) FROM encounter WHERE encounter_type=14 AND patient_id=a.patient_id) >= 1 THEN 'POSITIVE' ELSE 'NEGATIVE' END AS 'HIV STATUS',
CASE WHEN (SELECT COUNT(patient_id) FROM encounter WHERE encounter_type=25 AND patient_id=a.patient_id) >= 1 THEN 'YES' ELSE 'NO' END AS 'ART STATUS',
CASE WHEN a.hiv_test = 1 THEN 'ELIGIBLE' WHEN  a.hiv_test = 0 THEN 'NOT ELIGIBLE' ELSE '' END AS 'HIV OUTCOME',
CASE WHEN a.ncd_test = 1 THEN 'ELIGIBLE' WHEN  a.ncd_test = 0 THEN 'NOT ELIGIBLE' ELSE '' END AS 'NCD OUTCOME',
a.encounter_date AS 'ENCOUNTER DATE',
a.date_created AS 'DATE CREATED'
FROM integrator_client_intake a
INNER JOIN integrator_service_area b
ON a.service_area_id=b.service_area_id
WHERE a.date_created BETWEEN '2023-08-01' AND '2023-10-01';
